"use strict";(self.webpackChunkwebshop_client=self.webpackChunkwebshop_client||[]).push([[718],{5718:(z,m,r)=>{r.r(m),r.d(m,{CheckoutModule:()=>Y});var s=r(6895),i=r(433),a=r(6684),h=r(4466),t=r(1571),p=r(142);let d=(()=>{class o{constructor(n,e){this.router=n,this.localstorageToken=e}canActivate(n,e){const l=this.localstorageToken.getToken();if(l){const c=JSON.parse(atob(l.split(".")[1]));if(c.isAdmin&&!this._tokenExpired(c.exp))return!0}return this.router.navigate(["/login"]),!1}_tokenExpired(n){return Math.floor((new Date).getTime()/1e3)>=n}}return o.\u0275fac=function(n){return new(n||o)(t.LFG(a.F0),t.LFG(p.g))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var g=r(7579),k=r(2722),C=r(5624),f=r(7585),v=r(7977),F=r(5593),Z=r(6362),_=r(1740),P=r(3520),T=r(3602);function y(o,u){1&o&&(t.TgZ(0,"small",25),t._uU(1,"Name is required"),t.qZA())}function O(o,u){1&o&&(t.TgZ(0,"span"),t._uU(1,"email is required"),t.qZA())}function A(o,u){1&o&&(t.TgZ(0,"span"),t._uU(1,"email is invalid"),t.qZA())}function I(o,u){if(1&o&&(t.TgZ(0,"small",25),t.YNc(1,O,2,0,"span",26),t.YNc(2,A,2,0,"span",26),t.qZA()),2&o){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",null==n.checkoutForm||null==n.checkoutForm.email||null==n.checkoutForm.email.errors?null:n.checkoutForm.email.errors.required),t.xp6(1),t.Q6J("ngIf",null==n.checkoutForm||null==n.checkoutForm.email||null==n.checkoutForm.email.errors?null:n.checkoutForm.email.errors.email)}}function M(o,u){1&o&&(t.TgZ(0,"small",25),t._uU(1,"phone is required"),t.qZA())}function b(o,u){1&o&&(t.TgZ(0,"small",25),t._uU(1,"Street is required"),t.qZA())}function q(o,u){1&o&&(t.TgZ(0,"small",25),t._uU(1,"Apartment is required"),t.qZA())}function U(o,u){1&o&&(t.TgZ(0,"small",25),t._uU(1,"Zip is required"),t.qZA())}function S(o,u){1&o&&(t.TgZ(0,"small",25),t._uU(1,"City is required"),t.qZA())}function N(o,u){1&o&&(t.TgZ(0,"small",25),t._uU(1,"Country is required"),t.qZA())}const J=[{path:"",children:[{path:"",pathMatch:"full",redirectTo:"checkout"},{path:"",component:(()=>{class o{constructor(n,e,l,c,x){this.router=n,this.usersService=e,this.formBuilder=l,this.cartService=c,this.ordersService=x,this.endSubs$=new g.x,this.isSubmitted=!1,this.orderItems=[],this.countries=[]}ngOnInit(){this._initCheckoutForm(),this._autoFillUserData(),this._getCartItems(),this._getCountries()}_getCartItems(){const n=this.cartService.getCart();this.orderItems=n.items?.map(e=>({product:e.productId,quantity:e.quantity}))}_initCheckoutForm(){this.checkoutFormGroup=this.formBuilder.group({name:["",i.kI.required],email:["",[i.kI.email,i.kI.required]],phone:["",i.kI.required],city:["",i.kI.required],country:["",i.kI.required],zip:["",i.kI.required],apartment:["",i.kI.required],street:["",i.kI.required]})}_getCountries(){this.countries=this.usersService.getCountries()}backToCart(){this.router.navigate(["/cart"])}placeOrder(){if(this.isSubmitted=!0,this.checkoutFormGroup.invalid)return;const n={orderItems:this.orderItems,shippingAddress1:this.checkoutForm?.street.value,shippingAddress2:this.checkoutForm?.apartment.value,city:this.checkoutForm?.city.value,zip:this.checkoutForm?.zip.value,country:this.checkoutForm?.country.value,phone:this.checkoutForm?.phone.value,status:0,user:this.userId,dateOrdered:`${Date.now()}`};this.ordersService.cacheOrderData(n),this.ordersService.createCheckoutSession(this.orderItems).subscribe(e=>{e&&console.log("error in redirect to payment")})}_autoFillUserData(){this.usersService.observeCurrentUser().pipe((0,k.R)(this.endSubs$)).subscribe(n=>{n&&(this.userId=n?.id,this.checkoutForm?.name.setValue(n?.name),this.checkoutForm?.email.setValue(n?.email),this.checkoutForm?.phone.setValue(n?.phone),this.checkoutForm?.street.setValue(n?.street),this.checkoutForm?.apartment.setValue(n?.apartment),this.checkoutForm?.zip.setValue(n?.zip),this.checkoutForm?.city.setValue(n?.city),this.checkoutForm?.country.setValue(n?.country))})}get checkoutForm(){return this.checkoutFormGroup.controls}ngOnDestroy(){this.endSubs$.next(null),this.endSubs$.complete()}}return o.\u0275fac=function(n){return new(n||o)(t.Y36(a.F0),t.Y36(C.f),t.Y36(i.qu),t.Y36(f.N),t.Y36(v.N))},o.\u0275cmp=t.Xpm({type:o,selectors:[["orders-checkout-page"]],decls:55,vars:12,consts:[[1,"checkout-page"],["label","Back to cart","icon","pi pi-arrow-left",3,"onClick"],[1,"grid","checkout-form"],[1,"col-8"],[3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"p-field","col-4"],["for","name"],["formControlName","name","id","name","type","text","pInputText",""],["class","p-error",4,"ngIf"],["for","email"],["formControlName","email","id","email","type","text","pInputText",""],["for","color"],["mask","(999) 999-9999","formControlName","phone","placeholder","(999) 999-9999"],["for","street"],["formControlName","street","id","street","type","text","pInputText",""],["formControlName","apartment","id","apartment","type","text","pInputText",""],["formControlName","zip","id","zip","type","text","pInputText",""],["for","city"],["formControlName","city","id","city","type","text","pInputText",""],["for","country"],["formControlName","country","optionLabel","name","optionValue","id","filterBy","name","placeholder","Select a Country",3,"options","filter","showClear"],[1,"col-4"],[1,"checkout-button"],["label","Place-Order",3,"onClick"],[1,"p-error"],[4,"ngIf"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div")(2,"p-button",1),t.NdJ("onClick",function(){return e.backToCart()}),t.qZA()(),t.TgZ(3,"div",2)(4,"div",2)(5,"div",3)(6,"form",4)(7,"div",5)(8,"div",6)(9,"label",7),t._uU(10,"Name"),t.qZA(),t._UZ(11,"input",8),t.YNc(12,y,2,0,"small",9),t.qZA(),t.TgZ(13,"div",6)(14,"label",10),t._uU(15,"Email"),t.qZA(),t._UZ(16,"input",11),t.YNc(17,I,3,2,"small",9),t.qZA(),t.TgZ(18,"div",6)(19,"label",12),t._uU(20,"Phone"),t.qZA(),t._UZ(21,"br")(22,"p-inputMask",13),t.YNc(23,M,2,0,"small",9),t.qZA()(),t.TgZ(24,"div",5)(25,"div",6)(26,"label",14),t._uU(27,"Street"),t.qZA(),t._UZ(28,"input",15),t.YNc(29,b,2,0,"small",9),t.qZA(),t.TgZ(30,"div",6)(31,"label",14),t._uU(32,"Apartment"),t.qZA(),t._UZ(33,"input",16),t.YNc(34,q,2,0,"small",9),t.qZA(),t.TgZ(35,"div",6)(36,"label",14),t._uU(37,"Zip Code"),t.qZA(),t._UZ(38,"input",17),t.YNc(39,U,2,0,"small",9),t.qZA(),t.TgZ(40,"div",6)(41,"label",18),t._uU(42,"City"),t.qZA(),t._UZ(43,"input",19),t.YNc(44,S,2,0,"small",9),t.qZA(),t.TgZ(45,"div",6)(46,"label",20),t._uU(47,"Country"),t.qZA(),t._UZ(48,"br")(49,"p-dropdown",21),t.YNc(50,N,2,0,"small",9),t.qZA()()()(),t.TgZ(51,"div",22),t._UZ(52,"orders-order-summary"),t.TgZ(53,"div",23)(54,"p-button",24),t.NdJ("onClick",function(){return e.placeOrder()})("onClick",function(){return e.placeOrder()}),t.qZA()()()()()()),2&n&&(t.xp6(6),t.Q6J("formGroup",e.checkoutFormGroup),t.xp6(6),t.Q6J("ngIf",(null==e.checkoutForm||null==e.checkoutForm.name?null:e.checkoutForm.name.invalid)&&e.isSubmitted),t.xp6(5),t.Q6J("ngIf",(null==e.checkoutForm||null==e.checkoutForm.email?null:e.checkoutForm.email.invalid)&&e.isSubmitted),t.xp6(6),t.Q6J("ngIf",(null==e.checkoutForm||null==e.checkoutForm.phone?null:e.checkoutForm.phone.invalid)&&e.isSubmitted),t.xp6(6),t.Q6J("ngIf",(null==e.checkoutForm||null==e.checkoutForm.street?null:e.checkoutForm.street.invalid)&&e.isSubmitted),t.xp6(5),t.Q6J("ngIf",(null==e.checkoutForm||null==e.checkoutForm.apartment?null:e.checkoutForm.apartment.invalid)&&e.isSubmitted),t.xp6(5),t.Q6J("ngIf",(null==e.checkoutForm||null==e.checkoutForm.zip?null:e.checkoutForm.zip.invalid)&&e.isSubmitted),t.xp6(5),t.Q6J("ngIf",(null==e.checkoutForm||null==e.checkoutForm.city?null:e.checkoutForm.city.invalid)&&e.isSubmitted),t.xp6(5),t.Q6J("options",e.countries)("filter",!0)("showClear",!0),t.xp6(1),t.Q6J("ngIf",(null==e.checkoutForm||null==e.checkoutForm.country?null:e.checkoutForm.country.invalid)&&e.isSubmitted))},dependencies:[s.O5,F.zx,Z.Lt,_.o,P.vy,T.h,i._Y,i.Fj,i.JJ,i.JL,i.sg,i.u],styles:[".checkout-page[_ngcontent-%COMP%]{min-height:500px;max-width:1300px;margin:0 auto}.checkout-page[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#ff3a00;border:0}.checkout-page[_ngcontent-%COMP%]   .checkout-form[_ngcontent-%COMP%]{margin-top:25px}.checkout-page[_ngcontent-%COMP%]   .checkout-button[_ngcontent-%COMP%]{margin-top:20px}.checkout-page[_ngcontent-%COMP%]   .checkout-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}@media (max-width: 768px){.checkout-page[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]{flex-direction:column}.checkout-page[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]   .col-8[_ngcontent-%COMP%]{width:100%}.checkout-page[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]   .col-8[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{width:80%;margin:0 auto}.checkout-page[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]   .col-8[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%], .checkout-page[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%]{width:100%}.checkout-page[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%]   .order-summary[_ngcontent-%COMP%]{width:90%;margin:0 auto}}"]}),o})(),canActivate:[d]}]}];let Y=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[s.ez,h.m,a.Bz.forChild(J),i.UX]}),o})()}}]);